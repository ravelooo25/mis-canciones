<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wrapped de Recuerdos</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
:root{--bg:#071022;--card:#0f1724;--accent:#1db954;--muted:rgba(230,238,245,0.65)}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,Montserrat,system-ui;background:linear-gradient(135deg,var(--bg),#041122 70%);color:#eaf2fb;-webkit-font-smoothing:antialiased}
.container{max-width:1200px;margin:28px auto;padding:20px}
.header{display:flex;align-items:center;gap:18px}
.logo{width:80px;height:80px;border-radius:16px;background:linear-gradient(135deg,#5eead4,#60a5fa);display:flex;align-items:center;justify-content:center;font-weight:800;color:#021024;font-size:20px}
.h1{font-family:Montserrat;font-weight:800;font-size:28px;margin:0}
.lead{color:var(--muted);margin-top:6px}
.grid{display:grid;grid-template-columns:360px 1fr;gap:22px;margin-top:20px}
.panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent),var(--card);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(2,8,20,0.6)}
.profile{display:flex;gap:12px;align-items:center}
.avatar{width:64px;height:64px;border-radius:12px;background:linear-gradient(180deg,#fff1,#0003);display:flex;align-items:center;justify-content:center;font-weight:800;color:#021024}
.info small{display:block;color:var(--muted);font-size:13px}
.counter{font-size:36px;font-weight:800;margin-top:6px}
.list{margin-top:14px;display:flex;flex-direction:column;gap:12px;max-height:62vh;overflow:auto;padding-right:6px}
.song{display:flex;gap:12px;align-items:center;padding:10px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);transition:transform .18s ease,box-shadow .18s ease;cursor:pointer}
.song:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(2,8,20,0.5)}
.art{width:64px;height:64px;border-radius:10px;flex-shrink:0;overflow:hidden}
.art img{width:100%;height:100%;object-fit:cover}
.meta h3{margin:0;font-size:15px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.meta p{margin:6px 0 0;color:var(--muted);font-size:13px}
.controls{margin-left:auto;display:flex;gap:8px;align-items:center}
.btn{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.03);padding:8px 12px;border-radius:10px;color:inherit;font-weight:700;cursor:pointer}
.btn.primary{background:linear-gradient(90deg,var(--accent),#2aa6ff);border:none;color:#021024}
.right{display:flex;flex-direction:column;gap:16px}
.hero{border-radius:16px;padding:18px;min-height:360px;display:flex;flex-direction:column;gap:12px}
.hero-top{display:flex;justify-content:space-between;align-items:center}
.big-title{font-family:Montserrat;font-weight:800;font-size:28px}
.chips{display:flex;gap:8px;align-items:center}
.chip{background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:999px;font-weight:700}
.cover-area{display:grid;grid-template-columns:220px 1fr;gap:18px;align-items:center}
.cover-art{width:220px;height:220px;border-radius:16px;overflow:hidden;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#fff1,#0003)}
.cover-art img{width:100%;height:100%;object-fit:cover}
.cover-info h2{margin:0;font-size:20px;font-weight:800}
.cover-info p{color:var(--muted);margin-top:8px}
.mood{display:flex;gap:8px;margin-top:8px}
.reason-panel{margin-top:10px;border-radius:12px;padding:14px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent)}
.reason-title{font-weight:800;margin:0}
.reason-text{color:var(--muted);margin-top:8px}
.controls-row{display:flex;gap:8px;align-items:center;margin-top:12px}
.progress{height:8px;background:rgba(255,255,255,0.04);border-radius:6px;overflow:hidden}
.progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),#2aa6ff)}
.carousel{display:flex;gap:12px;overflow:hidden;padding:8px;margin-top:12px}
.carousel .card{min-width:160px;flex:0 0 auto;transition:transform .4s cubic-bezier(.2,.9,.2,1)}
.card-cover{height:120px;border-radius:10px;overflow:hidden}
.card-cover img{width:100%;height:100%;object-fit:cover}
.fade-in{animation:fadeIn .5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
@media(max-width:900px){.grid{grid-template-columns:1fr}.cover-area{grid-template-columns:140px 1fr}.cover-art{width:140px;height:140px}.avatar{width:56px;height:56px}.counter{font-size:28px}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">WR</div>
    <div>
      <div class="h1">Wrapped de recuerdos</div>
      <div class="lead">Muestra canciones que te recuerdan a alguien. Hazlo visual, musical y personal.</div>
    </div>
  </div>

  <div class="grid">
    <aside class="panel">
      <div class="profile">
        <div class="avatar" id="miniAvatar">T</div>
        <div class="info">
          <small id="targetName">Para: Milena</small>
          <div class="counter" id="countSongs">0 canciones</div>
        </div>
      </div>

      <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
        <strong>Top canciones</strong>
        <div>
          <button class="btn" id="shuffleBtn">Mezclar</button>
        </div>
      </div>

      <div class="list" id="songList"></div>
    </aside>

    <section class="right">
      <div class="panel hero fade-in">
        <div class="hero-top">
          <div>
            <div class="big-title" id="titleMain">Canciones que me recuerdan a alguien</div>
            <div class="lead" id="subtitleMain">Selecciona una canción para ver detalles y escuchar.</div>
          </div>
          <div class="chips">
            <div class="chip" id="totalTime">0:00</div>
            <div class="chip" id="moodTag">Noche</div>
          </div>
        </div>

        <div class="cover-area">
          <div class="cover-art" id="bigArt"></div>
          <div class="cover-info">
            <h2 id="coverTitle">Tu playlist de recuerdos</h2>
            <p id="coverSubtitle">Selecciona una canción para ver la portada, la razón y reproducir.</p>

            <div class="mood" id="chipsArea">
              <div class="chip">Nostalgia</div>
              <div class="chip">Mensajes</div>
              <div class="chip">Viaje</div>
            </div>

            <div class="controls-row">
              <div style="flex:1">
                <div class="progress" id="progressBar"><i></i></div>
              </div>
              <div id="timeLabel" style="min-width:56px;color:var(--muted);text-align:right">0:00</div>
            </div>
          </div>
        </div>

        <div class="reason-panel" id="reasonPanel">
          <div class="reason-title" id="reasonTitle">Selecciona una canción</div>
          <div class="reason-text" id="reasonText">Aquí verás por qué esa canción te recuerda a Milena. Además se reproducirá la pista para acompañar el momento.</div>
        </div>

        <div class="carousel" id="carousel"></div>
      </div>

      <div class="panel" id="playerWrap"></div>
    </section>
  </div>
</div>

<script>
// helpers
const $ = s => document.querySelector(s);
const songListEl = $('#songList');
const countSongsEl = $('#countSongs');
const bigArtEl = $('#bigArt');
const coverTitleEl = $('#coverTitle');
const coverSubtitleEl = $('#coverSubtitle');
const playerWrap = $('#playerWrap');
const progressBar = $('#progressBar > i');
const timeLabel = $('#timeLabel');
const reasonTitle = $('#reasonTitle');
const reasonText = $('#reasonText');
const carousel = $('#carousel');
const totalTimeEl = $('#totalTime');
const miniAvatar = $('#miniAvatar');
const targetName = $('#targetName');

let songs = [];
let currentIndex = -1;
let audioEl = new Audio();

function formatTime(s){if(!s) return '0:00'; let m=Math.floor(s/60), sec=Math.floor(s%60); return m+':'+(sec<10?'0'+sec:sec)}

function escapeHtml(s){return String(s||'').replace(/[&<>\"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]))}

function placeholder(i){
  const grads = ['linear-gradient(135deg,#5eead4,#60a5fa)','linear-gradient(135deg,#f6d365,#fda085)','linear-gradient(135deg,#a18cd1,#fbc2eb)'];
  const g = grads[i%grads.length];
  const svg = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='600' height='600'><rect width='100%' height='100%' fill='${g}'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-family='Montserrat, Arial' font-size='40' fill='#021024'>Cover</text></svg>`);
  return 'data:image/svg+xml;charset=utf-8,'+svg;
}

function renderList(){
  songListEl.innerHTML = '';
  carousel.innerHTML = '';
  songs.forEach((s,i)=>{
    const div = document.createElement('div'); div.className='song';
    div.innerHTML = `
      <div class='art'><img src='${s.img||placeholder(i)}' alt=''></div>
      <div class='meta'><h3>${escapeHtml(s.title)}</h3><p>${escapeHtml(s.artist)} · ${escapeHtml(s.reason||'')}</p></div>
      <div class='controls'><button class='btn' onclick='selectSong(${i})'>Abrir</button></div>`;
    songListEl.appendChild(div);

    const c = document.createElement('div'); c.className='panel card-cover card'; c.style.minWidth='160px';
    c.innerHTML = `<div class='card-cover'><img src='${s.img||placeholder(i)}'></div><div style='padding:8px'><strong style='display:block'>${escapeHtml(s.title)}</strong><small style='color:var(--muted)'>${escapeHtml(s.artist)}</small></div>`;
    c.onclick = ()=>selectSong(i);
    carousel.appendChild(c);
  });
  countSongsEl.textContent = songs.length + (songs.length==1? ' canción' : ' canciones');
  totalTimeEl.textContent = formatTime(songs.length*210);
}

function selectSong(i){
  const s = songs[i];
  if(!s) return;
  currentIndex = i;
  bigArtEl.innerHTML = `<img src='${s.img||placeholder(i)}' alt='' style='width:100%;height:100%;object-fit:cover'>`;
  coverTitleEl.textContent = s.title;
  coverSubtitleEl.textContent = s.artist + (s.reason? ' · '+s.reason:'');
  reasonTitle.textContent = s.title;
  reasonText.textContent = s.reason || 'Sin motivo escrito.';

  stopAudio();

  if(s.audio.endsWith('.mp4') || s.audio.endsWith('.mp3')){
    playerWrap.innerHTML = `<video id='mainVideo' src='${s.audio}' controls autoplay style='width:100%'></video>`;
    audioEl = document.getElementById('mainVideo');
    audioEl.addEventListener('timeupdate', onTime);
    audioEl.addEventListener('ended', onEnded);
  } else {
    playerWrap.innerHTML = `<div style='padding:14px;color:var(--muted)'>No hay preview para esta pista</div>`;
    progressBar.style.width='0%';
    timeLabel.textContent='0:00';
  }

  Array.from(carousel.children).forEach((c,idx)=>{c.style.transform = idx===i? 'translateY(-8px) scale(1.02)':'none'});
}

function onTime(){
  if(!audioEl || isNaN(audioEl.duration)) return;
  const pct = (audioEl.currentTime / audioEl.duration)*100;
  progressBar.style.width = pct + '%';
  timeLabel.textContent = formatTime(audioEl.currentTime);
}

function onEnded(){progressBar.style.width='100%';timeLabel.textContent=formatTime(audioEl.duration)}

function stopAudio(){
  if(audioEl){
    try{audioEl.pause();audioEl.currentTime=0;}catch(e){}
    audioEl.removeEventListener('timeupdate',onTime);
    audioEl.removeEventListener('ended',onEnded);
  }
  playerWrap.innerHTML = '';
}

function setTargetName(t){targetName.textContent = 'Para: '+t; miniAvatar.textContent = (t||'T').slice(0,1).toUpperCase();}

// cargar playlist.json
fetch('playlist.json')
  .then(res => res.json())
  .then(data => {
    songs = data;
    renderList();
    selectSong(0);
  });

</script>
</body>
</html>
